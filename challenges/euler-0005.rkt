;;;---------------------------------------------------------------------------------------------------
;;; Project Euler 5: Smallest Multiple
;;;---------------------------------------------------------------------------------------------------

#lang racket/base

(provide test solve)

(require "../lib/prime-gen.rkt")


;;;---------------------------------------------------------------------------------------------------
;;; Solution
;;;---------------------------------------------------------------------------------------------------

(define (euler n)
  (let ((p-gen (make-prime-gen2)))
    (let loop ((s 1)
               (p (p-gen 'next)))
      (if (<= p n)
          (let* ((n/p (quotient n p))
                 (q (let loop ((q 1))
                      (if (<= q n/p)
                          (loop (* p q))
                          q))))
            (loop (* s q) (p-gen 'next)))
          s))))


;;;---------------------------------------------------------------------------------------------------
;;; Runme interface
;;;---------------------------------------------------------------------------------------------------

(define (test) (= 2520 (euler 10)))
(define (solve) (euler 20))